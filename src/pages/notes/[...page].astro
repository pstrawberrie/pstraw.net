---
import { SITE } from "@constants";
import { getPageMenuLinksFromPath, isDevelopment } from "@util";
import { getCollection } from "astro:content";
import CollectionLayout from "@layouts/CollectionLayout.astro";
import NoteCard from "@components/NoteCard.svelte";
import Pagination from "@components/Pagination.astro";

const pageMenuLinks = getPageMenuLinksFromPath("/notes");

export async function getStaticPaths({ paginate }) {
  const notes = await getCollection("notes", ({ data }) =>
    isDevelopment ? true : data.published,
  );
  const sortedNotes = notes.sort(
    (a, b) =>
      new Date(b.data.updated || b.data.date) -
      new Date(a.data.updated || a.data.date),
  );
  return paginate(sortedNotes, { pageSize: SITE.NOTES_PER_PAGE });
}

const { page } = Astro.props;
const { total, currentPage, lastPage } = page;
---

<CollectionLayout
  pageTitle={`Browse Notes${currentPage > 1 ? " (" + currentPage + "/" + lastPage + ")" : ""}`}
  pageDescription="Browse All Notes"
  heroTitle="All Notes"
  heroSubtitle={`Browse all notes (${total})`}
  heroColor="primary"
  {pageMenuLinks}
  pageMenuColor="primary"
  {currentPage}
>
  <section class="container">
    <Pagination
      {total}
      {currentPage}
      {lastPage}
      label="notes"
      nextUrl={page.url.next}
      prevUrl={page.url.prev}
    />

    <div class="grid-default">
      {page.data.map((note) => <NoteCard itemData={note} />)}
    </div>

    <Pagination
      {total}
      {currentPage}
      {lastPage}
      label="notes"
      nextUrl={page.url.next}
      prevUrl={page.url.prev}
    />
  </section>
</CollectionLayout>
